version: "{build}-{branch}"

# If we ever get a backlog larger than clone_depth, builds will fail
# spuriously. I do not think we will ever get 20 deep commits deep though.
clone_depth: 20


# build with MSBuild
build:
  project: StateMachine.sln             # path to Visual Studio solution or project
  parallel: true                        # enable MSBuild parallel builds
  verbosity: normal                     # MSBuild verbosity level {quiet|minimal|normal|detailed}


# Sadly we cannot use the standard "dimensions" based approach towards
# specifying the different builds, as there is no way to add one-offs
# builds afterwards. This means that we will painfully specify each
# build explicitly.
environment:
  matrix:
    - FLAVOR: VS 2022 x64 Release
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2022
      platform: x64
      configuration: Release
      
    - FLAVOR: VS 2022 x64 Debug
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2022
      platform: x64
      configuration: Debug
  
    - FLAVOR: VS 2019 x64 Debug Surrogates Configure Tests
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
      surrogates: 1
      configure_tests: 1
      platform: x64
      configuration: Debug
    
    - FLAVOR: VS 2019 x64 Release
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
      platform: x64
      configuration: Release

    - FLAVOR: VS 2019 x64 Debug Coverage Examples
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
      examples: 1
      coverage: 1
      platform: x64
      configuration: Debug

    - FLAVOR: VS 2019 x64 Debug WMain
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
      wmain: 1
      additional_flags: "/D_UNICODE /DUNICODE"
      platform: x64
      configuration: Debug

    - FLAVOR: VS 2019 Win32 Debug
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
      platform: Win32
      configuration: Debug

    - FLAVOR: VS 2019 x64 Debug Latest Strict
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
      additional_flags: "/permissive- /std:c++latest"
      platform: x64
      configuration: Debug

    - FLAVOR: VS 2017 x64 Debug
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
      platform: x64
      configuration: Debug
    
    - FLAVOR: VS 2017 x64 Release
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
      platform: x64
      configuration: Release

    - FLAVOR: VS 2017 x64 Release Coverage
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
      coverage: 1
      platform: x64
      configuration: Debug

    - FLAVOR: VS 2017 Win32 Debug
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
      platform: Win32
      configuration: Debug

    - FLAVOR: VS 2017 Win32 Debug Examples
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
      examples: 1
      platform: Win32
      configuration: Debug

    - FLAVOR: VS 2017 Win32 Debug WMain
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
      wmain: 1
      additional_flags: "/D_UNICODE /DUNICODE"
      platform: Win32
      configuration: Debug

    - FLAVOR: VS 2017 x64 Debug Latest Strict
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
      additional_flags: "/permissive- /std:c++latest"
      platform: x64
      configuration: Debug